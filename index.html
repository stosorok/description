<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>–û–ø–∏—Å 1.2</title>
<link rel="apple-touch-icon" href="icon.png" />

<style>
  :root{
    --green: #48d597;
    --violet: #b6a9f7;
    --bg: #eeeeee;
    --fg: #414141;
    --white: #ffffff;
    --muted: #cccccc;
    --inactive-bg: #eeeeee;
    --text-color: #414141;
  }

  .pill {
  display: inline-flex;
  align-items: center;
  margin: 3px;
  cursor: pointer;
  user-select: none;
}

.pill input {
  display: none;
}

.pill span {
  padding: 6px 12px;
  border-radius: 12px;
  background-color: var(--inactive-bg);
  color: var(--text-color);
  font-size: 0.9rem;
  transition: 0.2s;
}

.pill input:checked + span {
  background-color: var(--green); /* –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞/—Ä–∞–¥–∏–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ */
  color: #ffffff;
}

/* –î–ª—è —Ä–æ–∑–º—ñ—Ä—ñ–≤, –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–º–∏ –∑–∞–º—ñ—Å—Ç—å –∑–µ–ª–µ–Ω–∏—Ö */
.sizes .pill input:checked + span {
  background-color: var(--violet);
  color: #ffffff;
}

  html,body{height:100%;margin:0;padding:10px;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;color:var(--fg);}

  /* SPLASH */
  #splash{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;
    background:linear-gradient(135deg,#fc00ff 0%,#00dbde 100%);color:#fff;transition:opacity .45s;}
  #splash svg{width:80px;height:80px;margin-bottom:12px;}
  #splash .s-title{font-weight:800;font-size:22px;margin:0;}
  #splash .s-ver{position:absolute;bottom:18px;font-size:13px;opacity:0.95;}

  /* LAYOUT */
  .container{max-width:760px;margin:0 auto;padding:6px;}
  h1{ text-align:center; margin:6px 0 12px; color:var(--fg); font-size:20px; }

  label.section{display:block;font-weight:700;margin-bottom:6px;}
  .form-section{margin-bottom:12px;}

  input[type="text"], input[type="number"], textarea {
    width:100%; box-sizing:border-box; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:15px; background:var(--white);
  }

  textarea { min-height:110px; resize:vertical; }

  /* inline groups for state/size */
  .inline { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .inline label { display:flex; align-items:center; gap:6px; font-weight:500; cursor:pointer; }

  /* Categories */
  .category-group{ display:flex; gap:8px; flex-wrap:wrap; }
  .category-pill{ background:var(--violet); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:700; user-select:none; }
  .category-pill.active{ background:var(--green); }

  .cat-fields{ margin-top:10px; display:flex; flex-direction:column; gap:8px; }
  .cat-row{ display:flex; gap:12px; align-items:center; }
  .cat-row label{ width:120px; margin:0; font-weight:600; }
  .cat-row input{ flex:1; padding:6px; }

  @media (max-width:420px) { .cat-row label{ width:95px; } }

  /* materials wrap */
  .materials{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  .materials label{ width:48%; display:flex; align-items:center; gap:6px; }

  /* ACTIONS */
  .actions{ display:flex; gap:10px; margin-top:8px; }
  .btn{ flex:1; padding:10px; border-radius:8px; border:0; color:#fff; font-weight:800; cursor:pointer; background:var(--green); }
  .btn.secondary{ background:var(--violet); }
  /* press effect for touch (short darkening) */
  .btn, .icon-btn, .category-pill {
    transition: filter .06s, transform .06s;
    -webkit-tap-highlight-color: transparent;
  }
  .btn:active{ filter:brightness(.85); transform:translateY(1px); }
  .icon-btn:active{ filter:brightness(.85); transform:translateY(1px); }
  .category-pill:active{ filter:brightness(.9); transform:translateY(1px); }

  /* OUTPUT */
  #output{ width:100%; border-radius:8px; padding:8px; box-sizing:border-box; min-height:160px; max-height:60vh; overflow:hidden; resize:none; background:#fff; border:1px solid #ccc; }

  /* saved list / accordion */
  #savedList{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }
  .saved-item{ border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.04); border:1px solid #e6e6e6; }
  .saved-header{
    display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; cursor:pointer; user-select:none;
    background:var(--violet); color:#fff; font-weight:700;
  }
  .saved-header.copied{ background:#cccccc; color:#111; }
  .saved-body{ padding:10px 12px; background:#fff; color:#222; white-space:pre-line; display:none; }

  .saved-actions{ display:flex; gap:8px; align-items:center; }

  .icon-btn{
    display:inline-flex; align-items:center; justify-content:center; gap:6px;
    padding:6px 8px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:#fff; color:var(--fg); cursor:pointer;
  }
  .icon-btn img{ width:18px; height:18px; border-radius:6px; display:block; }

  /* delete icon inside header ‚Äî we use SVG fill:currentColor so color follows header text color */
  .icon-btn svg{ width:16px; height:16px; display:block; }

  /* Clear (floating) button - restore previous square style (not round gradient) */
  .fab-clear{
    position:fixed; right:14px; bottom:14px; width:48px; height:48px; background:#414141; border-radius:10px; display:flex;
    align-items:center; justify-content:center; z-index:999; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,0.2);
  }
  .fab-clear svg{ width:22px; height:22px; fill:#fff; }
  .fab-clear:active{ filter:brightness(.85); transform:translateY(1px); }

  /* brand suggestions */
  .autocomplete-wrap{ position:relative; }
  .suggestions{ position:absolute; left:0; right:0; background:#fff; border:1px solid #ccc; border-top:none; z-index:50; max-height:220px; overflow:auto; border-radius:0 0 8px 8px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
  .suggestion{ padding:8px 10px; cursor:pointer; }
  .suggestion.active, .suggestion:hover{ background:#f3f3f3; }

  /* small helpers */
  .muted{ color:#666; font-size:13px; }
  .hidden{ display:none !important; }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash" role="dialog" aria-hidden="false">
  <!-- üîß –Ü–∫–æ–Ω–∫—É –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ —Ç—É—Ç -->
  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <path d="m21.72 10.13-2.29 2.3c-.39.39-1.03.39-1.42 0l-.01-.02V18c0 1.65-1.35 3-3 3H9c-1.65 0-3-1.35-3-3v-5.59l-.01.02c-.39.39-1.03.39-1.42 0l-2.29-2.3c-.78-.78-.78-2.04 0-2.82l4.01-4.02C6.48 3.11 6.73 3 7 3h2c.31 0 .61.15.8.4.52.7 1.33 1.1 2.2 1.1s1.68-.4 2.2-1.1c.19-.25.49-.4.8-.4h2c.27 0 .52.11.71.29l4.01 4.02c.78.78.78 2.04 0 2.82z" fill="#ffffff"></path>
  </svg>
  <div class="s-title">–û–ø–∏—Å 1.2</div>
  <div class="s-ver">–≤–µ—Ä—Å—ñ—è 1.2</div>
</div>

<div class="container hidden" id="app">
  <h1>–û–ø–∏—Å 1.2</h1>

  <!-- –¶—ñ–Ω–∞ -->
  <div class="form-section">
    <label class="section" for="price">–¶—ñ–Ω–∞ üí∏</label>
    <input id="price" type="number" inputmode="decimal" step="0.01" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 450">
  </div>

  <!-- –ë—Ä–µ–Ω–¥ –∑ –∞–≤—Ç–æ–¥–æ–ø–æ–º–æ–≥–æ—é -->
  <div class="form-section">
    <label class="section" for="brand">–ë—Ä–µ–Ω–¥</label>
    <div class="autocomplete-wrap">
      <input id="brand" type="text" placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –±—Ä–µ–Ω–¥..." autocomplete="off" />
      <div id="brandSuggestions" class="suggestions" style="display:none"></div>
    </div>
  </div>

  <!-- –û–ø–∏—Å -->
  <div class="form-section">
    <label class="section" for="descInput">–û–ø–∏—Å</label>
    <input id="descInput" type="text" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —É 1 —Ä–µ—á–µ–Ω–Ω—ñ" />
  </div>

  <!-- –°—Ç–∞–Ω -->
<div class="state">
  <span>–°—Ç–∞–Ω:</span>
  <label class="pill">
    <input type="radio" name="state" value="–°—Ç–∞–Ω —á—É–¥–æ–≤–∏–π">
    <span>–°—Ç–∞–Ω —á—É–¥–æ–≤–∏–π</span>
  </label>
  <label class="pill">
    <input type="radio" name="state" value="–°—Ç–∞–Ω –¥—É–∂–µ —Ö–æ—Ä–æ—à–∏–π">
    <span>–°—Ç–∞–Ω –¥—É–∂–µ —Ö–æ—Ä–æ—à–∏–π</span>
  </label>
</div>

  <hr>

  <!-- –†–æ–∑–º—ñ—Ä -->

<div class="sizes">
  <span>–†–æ–∑–º—ñ—Ä:</span>
  <label class="pill">
    <input type="checkbox" value="XS">
    <span>XS</span>
  </label>
  <label class="pill">
    <input type="checkbox" value="S">
    <span>S</span>
  </label>
  <label class="pill">
    <input type="checkbox" value="M">
    <span>M</span>
  </label>
  <label class="pill">
    <input type="checkbox" value="L">
    <span>L</span>
  </label>
  <label class="pill">
    <input type="checkbox" value="XL">
    <span>XL</span>
  </label>
  <label class="pill">
    <input type="checkbox" value="XXL">
    <span>XXL</span>
  </label>
</div>

  <hr>

  <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div class="form-section">
    <label class="section">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
    <div class="category-group" id="categoryGroup">
      <div class="category-pill" data-cat="sweater">–°–≤–µ—Ç—Ä</div>
      <div class="category-pill" data-cat="pants">–®—Ç–∞–Ω–∏</div>
      <div class="category-pill" data-cat="skirt">–°–ø—ñ–¥–Ω–∏—Ü—è</div>
      <div class="category-pill" data-cat="tshirt">–§—É—Ç–±–æ–ª–∫–∞</div>
      <div class="category-pill" data-cat="outerwear">–í–µ—Ä—Ö–Ω—ñ–π –æ–¥—è–≥</div>
    </div>

    <div id="categoryFields" class="cat-fields"></div>
  </div>

  <hr>

  <!-- –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ -->
  <div class="form-section materials">
    <label class="section">–ú–∞—Ç–µ—Ä—ñ–∞–ª</label>
    <label><input type="checkbox" value="–±–∞–≤–æ–≤–Ω–∞"> –ë–∞–≤–æ–≤–Ω–∞</label>
    <label><input type="checkbox" value="–≤—ñ—Å–∫–æ–∑–∞"> –í—ñ—Å–∫–æ–∑–∞</label>
    <label><input type="checkbox" value="–µ–ª–∞—Å—Ç–∞–Ω"> –ï–ª–∞—Å—Ç–∞–Ω</label>
    <label><input type="checkbox" value="–≤–æ–≤–Ω–∞"> –í–æ–≤–Ω–∞</label>
    <label><input type="checkbox" value="–∫–∞—à–µ–º—ñ—Ä"> –ö–∞—à–µ–º—ñ—Ä</label>
    <label><input type="checkbox" value="–Ω–µ–π–ª–æ–Ω"> –ù–µ–π–ª–æ–Ω</label>
    <label><input type="checkbox" value="–ø–æ–ª—ñ–∞–º—ñ–¥"> –ü–æ–ª—ñ–∞–º—ñ–¥</label>
    <label><input type="checkbox" value="–∞–∫—Ä–∏–ª"> –ê–∫—Ä–∏–ª</label>
    <label><input type="checkbox" value="–ø–æ–ª—ñ–µ—Å—Ç–µ—Ä"> –ü–æ–ª—ñ–µ—Å—Ç–µ—Ä</label>
    <label><input type="checkbox" value="–ª—å–æ–Ω"> –õ—å–æ–Ω</label>
    <label><input type="checkbox" value="–∞–ª—å–ø–∞–∫–∞"> –ê–ª—å–ø–∞–∫–∞</label>
    <label><input type="checkbox" value="–º–æ—Ö–µ—Ä"> –ú–æ—Ö–µ—Ä</label>
    <label><input type="checkbox" value="–º–µ—Ä–∏–Ω–æ—Å"> –ú–µ—Ä–∏–Ω–æ—Å</label>

    <div style="margin-top:8px;">
      <input id="materialCustom" type="text" placeholder="–Ü–Ω—à–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª">
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ -->
  <div class="form-section actions">
    <button id="btnGenerate" class="btn">–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
    <button id="btnCopy" class="btn secondary">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
    <button id="btnSave" class="btn" style="background:#414141">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
  </div>

  <!-- Output -->
  <div class="form-section">
    <textarea id="output" readonly></textarea>
  </div>

  <!-- –ó–±–µ—Ä–µ–∂–µ–Ω—ñ (–∞–∫–æ—Ä–¥–µ–æ–Ω–∏) -->
  <div id="savedList"></div>

  <div style="margin-top:12px; text-align:center;">
    <button id="btnClearAll" style="padding:8px 12px; border-radius:8px; border:0; background:var(--green); color:#fff; font-weight:700;">üóë –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å–µ</button>
  </div>
</div>

<!-- floating clear (previous square style) -->
<button class="fab-clear" id="fabClear" title="–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª—è">
  <!-- –º–µ—Ç–ª–∞/—Å–º—ñ—Ç—Ç—è –±—É–ª–∞ –ø—Ä–æ—Å–∏–ª–∞—Å—å —Ä–∞–Ω—ñ—à–µ ‚Äî —Ç—É—Ç –ø—Ä–æ—Å—Ç–∏–π –º–µ—Ç–µ–ª–∏–∫/–º—ñ—Ç–ª–∞ icon -->
  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <path d="M3 6h18v2H3V6zm2 3h14v12H5V9zm3 2v8h2v-8H8zm4 0v8h2v-8h-2zM9 4V2h6v2h5v2H4V4h5z"/>
  </svg>
</button>

<script>
/* ================= CONFIG ================= */
const APP_VERSION = "1.2";
const STORAGE_KEY = "savedDescriptions_v1_2";
const OLD_KEY = "savedDescriptions_v1_1_1"; // migrate if exists

// DELETE SVG (user-provided 'X' icon) - set fill to currentColor so it follows header text color
const DELETE_SVG = `<svg viewBox="-3.5 0 19 19" xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;display:block;"><path d="M11.383 13.644A1.03 1.03 0 0 1 9.928 15.1L6 11.172 2.072 15.1a1.03 1.03 0 1 1-1.455-1.456l3.928-3.928L.617 5.79a1.03 1.03 0 1 1 1.455-1.456L6 8.261l3.928-3.928a1.03 1.03 0 0 1 1.455 1.456L7.455 9.716z" fill="currentColor"/></svg>`;

// Shafa icon URL (for copy-without-price) -> we will embed as <img> in button
const COPY_NOPRICE_ICON = "https://shafa.c.prom.st/favicon-32x32.png";

/* ================ BRANDS (autocomplete) ================ */
const BRANDS = [
  "ZARA","H&M","M&S","George","Primark","F&F","Stradivarius","Bershka",
  "Pull & Bear","COS","Arket","Massimo Dutty","Next","New Look","& Other Stories",
  "Mango","ASOS","Topshop","Monki","Reiss","Autograph","Hugo Boss","Cashmere",
  "Woolmark","Ralph Lauren","Max Mara","Only","C&A"
];

/* ================ CATEGORY FIELDS & numeric list ================ */
const categoryFields = {
  sweater: ["–ø–æ –≥—Ä—É–¥–∏","–ø–æ –Ω–∏–∑—É","—Ä—É–∫–∞–≤","–¥–æ–≤–∂–∏–Ω–∞"],
  pants: ["–ø–æ –ø–æ—è—Å","–ø–æ —Å—Ç–µ–≥–Ω–∞","–ø–æ—Å–∞–¥–∫–∞","–¥–æ–≤–∂–∏–Ω–∞","—à–∏—Ä–∏–Ω–∞ –≤–Ω–∏–∑—É"],
  skirt: ["–ø–æ –ø–æ—è—Å","–ø–æ —Å—Ç–µ–≥–Ω–∞","–¥–æ–≤–∂–∏–Ω–∞"],
  tshirt: ["–ø–æ –≥—Ä—É–¥–∏","–ø–æ –Ω–∏–∑—É","–¥–æ–≤–∂–∏–Ω–∞"],
  outerwear: ["–ø–ª–µ—á—ñ","–ø–æ –≥—Ä—É–¥–∏","–ø–æ –Ω–∏–∑—É","—Ä—É–∫–∞–≤","–¥–æ–≤–∂–∏–Ω–∞"]
};

const numericFields = ["–ø–æ –≥—Ä—É–¥–∏","–ø–æ –Ω–∏–∑—É","—Ä—É–∫–∞–≤","–¥–æ–≤–∂–∏–Ω–∞","–ø–æ –ø–æ—è—Å","–ø–æ —Å—Ç–µ–≥–Ω–∞","–ø–æ—Å–∞–¥–∫–∞","—à–∏—Ä–∏–Ω–∞ –≤–Ω–∏–∑—É","–ø–ª–µ—á—ñ"];

/* =================== UTIL =================== */
function $(sel){ return document.querySelector(sel); }
function $all(sel){ return Array.from(document.querySelectorAll(sel)); }

function autosize(el){
  if(!el) return;
  el.style.height = "auto";
  el.style.height = Math.max(160, el.scrollHeight) + "px";
}

/* ================= SPLASH HIDE ================= */
window.addEventListener("load", ()=>{
  const splash = document.getElementById("splash");
  setTimeout(()=> {
    if(splash) splash.style.opacity = "0";
    setTimeout(()=> {
      if(splash && splash.parentNode) splash.parentNode.removeChild(splash);
      document.getElementById("app").classList.remove("hidden");
    }, 420);
  }, 700);
});
// fallback
setTimeout(()=>{ const s = document.getElementById("splash"); if(s && s.parentNode){ s.parentNode.removeChild(s); document.getElementById("app").classList.remove("hidden"); } }, 6000);

/* ================= BRAND AUTOCOMPLETE ================= */
const brandInput = $("#brand");
const suggestionsEl = $("#brandSuggestions");
let currentSuggestions = [];
let suggestionIndex = -1;

brandInput.addEventListener("input", onBrandInput);
brandInput.addEventListener("keydown", onBrandKeyDown);
brandInput.addEventListener("blur", ()=> setTimeout(()=> suggestionsEl.style.display='none', 140));

function onBrandInput(e){
  const v = e.target.value.trim().toLowerCase();
  if(!v){ suggestionsEl.style.display='none'; currentSuggestions=[]; suggestionIndex=-1; return; }
  currentSuggestions = BRANDS.filter(b => b.toLowerCase().includes(v));
  currentSuggestions.sort((a,b)=>{
    const av=a.toLowerCase(), bv=b.toLowerCase();
    const sa = av.startsWith(v), sb = bv.startsWith(v);
    if(sa && !sb) return -1;
    if(!sa && sb) return 1;
    return a.localeCompare(b);
  });
  renderBrandSuggestions();
}
function renderBrandSuggestions(){
  suggestionsEl.innerHTML = "";
  if(!currentSuggestions.length){ suggestionsEl.style.display='none'; return; }
  currentSuggestions.forEach((s,i)=>{
    const div = document.createElement("div");
    div.className = "suggestion";
    div.textContent = s;
    if(i===suggestionIndex) div.classList.add("active");
    div.addEventListener("mousedown", (ev)=> {
      brandInput.value = s;
      suggestionsEl.style.display='none';
      suggestionIndex = -1;
    });
    suggestionsEl.appendChild(div);
  });
  suggestionsEl.style.display = 'block';
}
function onBrandKeyDown(e){
  if(suggestionsEl.style.display === 'none') return;
  if(e.key === "ArrowDown"){ e.preventDefault(); suggestionIndex = Math.min(suggestionIndex+1, currentSuggestions.length-1); renderBrandSuggestions(); }
  else if(e.key === "ArrowUp"){ e.preventDefault(); suggestionIndex = Math.max(suggestionIndex-1, 0); renderBrandSuggestions(); }
  else if(e.key === "Enter"){ e.preventDefault(); if(suggestionIndex>=0 && currentSuggestions[suggestionIndex]){ brandInput.value = currentSuggestions[suggestionIndex]; suggestionsEl.style.display='none'; suggestionIndex=-1; } }
  else if(e.key === "Escape"){ suggestionsEl.style.display='none'; suggestionIndex=-1; }
}

/* ================= CATEGORY RENDER ================= */
const categoryGroup = document.getElementById("categoryGroup");
const catFieldsContainer = document.getElementById("categoryFields");
let activeCategory = null;

categoryGroup.addEventListener("click", (ev)=>{
  const pill = ev.target.closest(".category-pill");
  if(!pill) return;
  const cat = pill.dataset.cat;
  [...categoryGroup.querySelectorAll(".category-pill")].forEach(p => p.classList.remove("active"));
  pill.classList.add("active");
  activeCategory = cat;
  renderCategoryFields(cat);
});

function renderCategoryFields(cat){
  catFieldsContainer.innerHTML = "";
  if(!cat || !categoryFields[cat]) return;
  categoryFields[cat].forEach(field=>{
    const row = document.createElement("div");
    row.className = "cat-row";
    const lbl = document.createElement("label");
    lbl.textContent = field;
    const inp = document.createElement("input");
    if(numericFields.includes(field)){
      inp.type = "number";
      inp.inputMode = "numeric";
      inp.pattern = "[0-9]*";
    } else {
      inp.type = "text";
    }
    inp.dataset.field = field;
    row.appendChild(lbl);
    row.appendChild(inp);
    catFieldsContainer.appendChild(row);
  });
  if(cat === "sweater" || cat === "outerwear"){
    // add "–†—É–∫–∞–≤ –≤—ñ–¥ –≥–æ—Ä–ª–æ–≤–∏–Ω–∏" checkbox beneath
    const cbRow = document.createElement("div");
    cbRow.className = "cat-row";
    const spacer = document.createElement("label");
    spacer.textContent = ""; spacer.style.visibility = "hidden";
    const cbWrapper = document.createElement("div");
    cbWrapper.style.display = "flex";
    cbWrapper.style.alignItems = "center";
    cbWrapper.innerHTML = `<label style="font-weight:600"><input id="fromNeck" type="checkbox"> –†—É–∫–∞–≤ –≤—ñ–¥ –≥–æ—Ä–ª–æ–≤–∏–Ω–∏</label>`;
    cbRow.appendChild(spacer);
    cbRow.appendChild(cbWrapper);
    catFieldsContainer.appendChild(cbRow);
  }
}

/* ================= BUILD OUTPUT ================= */
function buildResultText(){
  const price = $("#price").value.trim();
  const brand = $("#brand").value.trim();
  const desc = $("#descInput").value.trim();
  const cond = (document.querySelector('input[name="condition"]:checked') || {}).value || "";
  const sizes = $all('.size-chk:checked').map(c=>c.value);
  let out = "";
  if(price) out += `üí∏–¶—ñ–Ω–∞ ${price} –≥—Ä–Ω\n`;
  if(brand) out += `${brand}\n`;
  if(desc) out += `${desc}\n`;
  if(cond) out += `${cond}\n`;
  out += "‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n";
  if(sizes.length) out += `—Ä–æ–∑–º—ñ—Ä ${sizes.join("/")} \n`;

  if(activeCategory){
    $all('#categoryFields input[data-field]').forEach(inp=>{
      if(inp.value && inp.value.toString().trim() !== ""){
        out += `${inp.dataset.field} ${inp.value.toString().trim()}\n`;
      }
    });
    const fromNeck = $("#fromNeck");
    if(fromNeck && fromNeck.checked){
      out = out.replace(/(—Ä—É–∫–∞–≤\s+)/, "—Ä—É–∫–∞–≤ –≤—ñ–¥ –≥–æ—Ä–ª–æ–≤–∏–Ω–∏ ");
    }
  }
  out += "‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n";
  const mats = $all('.materials input:checked').map(i=>i.value);
  const custom = $("#materialCustom").value.trim();
  if(custom) mats.push(custom);
  if(mats.length) out += mats.join("/") + "\n";
  return out.trim();
}

/* ================= AUTOSIZE OUTPUT ================= */
const outputEl = $("#output");
function updateOutputHeight(){ autosize(outputEl); }
outputEl.addEventListener("input", updateOutputHeight);
autosize(outputEl);

/* ================= LOCAL STORAGE (load/migrate) ================= */
let savedData = [];
function loadSavedData(){
  // migrate from OLD_KEY if exists and STORAGE_KEY empty
  try{
    const old = localStorage.getItem(OLD_KEY);
    const cur = localStorage.getItem(STORAGE_KEY);
    if(old && !cur){
      localStorage.setItem(STORAGE_KEY, old);
      localStorage.removeItem(OLD_KEY);
    }
  }catch(e){}
  try{
    savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]") || [];
  }catch(e){ savedData = []; }
}
function persistSaved(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData)); }

/* ================= RENDER SAVED LIST (accordion) ================= */
const savedListEl = $("#savedList");
function renderSavedList(){
  savedListEl.innerHTML = "";
  savedData.forEach((item, idx) => {
    const wrapper = document.createElement("div"); wrapper.className = "saved-item";
    const header = document.createElement("div"); header.className = "saved-header" + (item.copied ? " copied" : "");
    const title = document.createElement("div"); title.textContent = item.title;
    const actions = document.createElement("div"); actions.className = "saved-actions";

    // copy all button
    const copyAllBtn = document.createElement("button"); copyAllBtn.className = "icon-btn"; copyAllBtn.title = "–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –≤–µ—Å—å –æ–ø–∏—Å";
    copyAllBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M16 1H4a1 1 0 0 0-1 1v14h2V3h11V1zm3 4H8a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1zm-1 16H9V7h9v14z"/></svg>`;

    // copy-without-price button (use image icon)
    const copyNoPriceBtn = document.createElement("button"); copyNoPriceBtn.className = "icon-btn"; copyNoPriceBtn.title = "–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –±–µ–∑ —Ü—ñ–Ω–∏";
    const img = document.createElement("img"); img.src = COPY_NOPRICE_ICON; img.alt="cp"; copyNoPriceBtn.appendChild(img);

    // delete button (use DELETE_SVG)
    const delBtn = document.createElement("button"); delBtn.className = "icon-btn"; delBtn.title = "–í–∏–¥–∞–ª–∏—Ç–∏";
    delBtn.innerHTML = DELETE_SVG;

    actions.appendChild(copyAllBtn);
    actions.appendChild(copyNoPriceBtn);
    actions.appendChild(delBtn);

    header.appendChild(title);
    header.appendChild(actions);

    const body = document.createElement("div"); body.className = "saved-body"; body.textContent = item.text;

    // toggle body on header click (ignore clicks on action buttons)
    header.addEventListener("click", (ev)=>{
      if(ev.target.closest(".icon-btn")) return;
      const isVisible = body.style.display === "block";
      body.style.display = isVisible ? "none" : "block";
    });

    // copy all behavior (mark copied)
    copyAllBtn.addEventListener("click", (ev)=>{
      ev.stopPropagation();
      copyToClipboard(item.text);
      item.copied = true;
      persistSaved();
      renderSavedList();
    });

    // copy without price
    copyNoPriceBtn.addEventListener("click", (ev)=>{
      ev.stopPropagation();
      // remove first non-empty line that starts with üí∏–¶—ñ–Ω–∞ or first line unconditionally
      const lines = item.text.split(/\r?\n/);
      let startIdx = 0;
      // if first line contains '–¶—ñ–Ω–∞' or emoji, skip it
      if(lines.length && /—Üi–Ω|—Ü—ñ–Ω–∞|üí∏/i.test(lines[0])) startIdx = 1;
      const noPrice = lines.slice(startIdx).join("\n");
      copyToClipboard(noPrice);
      // do NOT mark as copied (only copyAll marks as copied), unless you want both to mark
    });

    // delete
    delBtn.addEventListener("click", (ev)=>{
      ev.stopPropagation();
      if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –æ–ø–∏—Å?")) return;
      savedData.splice(idx,1);
      persistSaved();
      renderSavedList();
    });

    wrapper.appendChild(header);
    wrapper.appendChild(body);
    savedListEl.appendChild(wrapper);
  });
}

/* ================= COPY helper ================= */
function copyToClipboard(text){
  if(!text) return;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).catch(()=> fallbackCopy(text));
  } else fallbackCopy(text);
}
function fallbackCopy(text){
  const ta = document.createElement("textarea");
  ta.value = text; document.body.appendChild(ta); ta.select();
  try{ document.execCommand("copy"); }catch(e){}
  ta.remove();
}

/* ================= BUTTONS: generate/copy/save ================= */
$("#btnGenerate").addEventListener("click", ()=>{
  const t = buildResultText();
  outputEl.value = t;
  autosize(outputEl);
});

$("#btnCopy").addEventListener("click", ()=>{
  if(!outputEl.value) return;
  copyToClipboard(outputEl.value);
});

$("#btnSave").addEventListener("click", ()=>{
  const text = outputEl.value.trim();
  if(!text){ alert("–ù–µ–º–∞—î —Ç–µ–∫—Å—Ç—É –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è."); return; }
  const title = $("#descInput").value.trim() || "–ë–µ–∑ –Ω–∞–∑–≤–∏";
  const id = Date.now().toString(36) + "-" + Math.random().toString(36).slice(2,8);
  savedData.unshift({ id, title, text, copied: false });
  persistSaved();
  renderSavedList();
  // clear inputs for new entry (leave saved list)
  clearFormInputsKeepingSaved();
});

/* ============== CLEAR ALL (saved items) ============== */
$("#btnClearAll").addEventListener("click", ()=>{
  if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –æ–ø–∏—Å—ñ?")) return;
  savedData = [];
  persistSaved();
  renderSavedList();
});

/* ============== FLOATING CLEAR (clears form inputs only) ============== */
$("#fabClear").addEventListener("click", ()=>{
  if(!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø–æ–ª—è —Ñ–æ—Ä–º–∏?")) return;
  clearFormInputsKeepingSaved();
});

/* ============== FORM CLEAR HELPERS ============== */
function clearFormInputsKeepingSaved(){
  $all('input[type="text"], input[type="number"], textarea').forEach(i => i.value = "");
  $all('input[type="checkbox"], input[type="radio"]').forEach(i => i.checked = false);
  catFieldsContainer.innerHTML = "";
  outputEl.value = "";
  autosize(outputEl);
  [...document.querySelectorAll(".category-pill")].forEach(p => p.classList.remove("active"));
  activeCategory = null;
  suggestionsEl.style.display = "none";
}

/* ============== INIT (load saved etc) ============== */
loadSavedData();
renderSavedList();
autosize(outputEl);

/* ============== UTILITY: prevent accidental Enter submit ============== */
document.addEventListener("keydown", function(e){
  if(e.key === "Enter" && e.target.tagName.toLowerCase() !== "textarea"){
    e.preventDefault();
  }
});
</script>
</body>
</html>
